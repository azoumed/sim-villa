<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Construction Villa Maroc 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .config-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .config-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .input-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        td {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .category-row {
            background: #e8eaf6 !important;
            font-weight: bold;
            color: #5e35b1;
        }
        
        .subtotal-row {
            background: #fff3e0 !important;
            font-weight: bold;
            color: #e65100;
        }
        
        .total-row {
            background: #c8e6c9 !important;
            font-weight: bold;
            color: #2e7d32;
            font-size: 15px;
        }
        
        .editable-input {
            width: 90px;
            padding: 6px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            text-align: right;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #667eea;
            background: #f0f7ff;
        }
        
        .editable-input.material {
            border-color: #4caf50;
        }
        
        .editable-input.labor {
            border-color: #ff9800;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .summary-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .summary-card .amount {
            font-size: 24px;
            font-weight: bold;
        }
        
        .btn {
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(102, 126, 234, 0.6);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        
        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(245, 87, 108, 0.6);
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
        }
        
        .legend {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .legend h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .legend p {
            color: #856404;
            font-size: 13px;
            margin: 5px 0;
        }
        
        .legend-item {
            display: inline-block;
            margin-right: 20px;
        }
        
        .legend-box {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .legend-box.material {
            background: #4caf50;
        }
        
        .legend-box.labor {
            background: #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Simulateur de Co√ªt de Construction - Villa 3 √âtages</h1>
            <p>Maroc 2025 | Sous-sol + RDC + 1er √âtage | Prix Personnalisables</p>
        </div>
        
        <div class="content">
            <!-- Configuration -->
            <div class="config-section">
                <h2>üìê Configuration du Projet</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Surface Sous-sol (m¬≤)</label>
                        <input type="number" id="surfaceSousSol" value="100" min="0">
                    </div>
                    <div class="input-group">
                        <label>Surface RDC (m¬≤)</label>
                        <input type="number" id="surfaceRDC" value="100" min="0">
                    </div>
                    <div class="input-group">
                        <label>Surface 1er √âtage (m¬≤)</label>
                        <input type="number" id="surface1erEtage" value="100" min="0">
                    </div>
                    <div class="input-group">
                        <label>P√©rim√®tre Cl√¥ture (m)</label>
                        <input type="number" id="perimetreClature" value="70" min="0">
                    </div>
                </div>
            </div>

            <!-- L√©gende -->
            <div class="legend">
                <h3>üí° Comment utiliser le simulateur ?</h3>
                <p>
                    <span class="legend-item">
                        <span class="legend-box material"></span>
                        <strong>Prix Mat√©riaux (vert)</strong> : Cliquez pour modifier le prix unitaire des mat√©riaux
                    </span>
                    <span class="legend-item">
                        <span class="legend-box labor"></span>
                        <strong>Prix Main d'≈íuvre (orange)</strong> : Cliquez pour modifier le co√ªt unitaire de la main d'≈ìuvre
                    </span>
                </p>
                <p>Tous les calculs se mettent √† jour automatiquement !</p>
            </div>

            <!-- Tableau des co√ªts -->
            <div class="table-container">
                <table id="costTable">
                    <thead>
                        <tr>
                            <th style="width: 250px;">Poste</th>
                            <th style="width: 80px;">Unit√©</th>
                            <th style="width: 90px;">Quantit√©</th>
                            <th style="width: 110px;">Prix Mat. Unit.</th>
                            <th style="width: 110px;">Prix M.O. Unit.</th>
                            <th style="width: 110px;">Co√ªt Mat√©riaux</th>
                            <th style="width: 110px;">Co√ªt M.O.</th>
                            <th style="width: 110px;">Total</th>
                        </tr>
                    </thead>
                    <tbody id="costTableBody">
                    </tbody>
                </table>
            </div>

            <!-- R√©sum√© -->
            <div class="summary-cards" id="summaryCards"></div>

            <!-- Export -->
            <div class="export-section">
                <button class="btn btn-export" onclick="exportToCSV()">üì• T√©l√©charger le devis (CSV)</button>
                <button class="btn btn-reset" onclick="resetPrices()">üîÑ R√©initialiser les prix</button>
            </div>
        </div>
    </div>

    <script>
        const defaultCostData = {
            "GROS ≈íUVRE": {
                "Terrassement et fondations": [
                    { item: "Terrassement g√©n√©ral", unit: "m¬≥", qtyPerM2: 0.3, priceUnit: 80, labor: 40 },
                    { item: "Semelles filantes b√©ton arm√©", unit: "m¬≥", qtyPerM2: 0.15, priceUnit: 1200, labor: 400 },
                    { item: "Longrines b√©ton arm√©", unit: "m¬≥", qtyPerM2: 0.08, priceUnit: 1400, labor: 450 }
                ],
                "Murs et structure": [
                    { item: "Poteaux b√©ton arm√©", unit: "m¬≥", qtyPerM2: 0.06, priceUnit: 1500, labor: 500 },
                    { item: "Murs en parpaings 20cm", unit: "m¬≤", qtyPerM2: 2.5, priceUnit: 75, labor: 35 },
                    { item: "Cha√Ænage horizontal", unit: "ml", qtyPerM2: 0.8, priceUnit: 180, labor: 70 }
                ],
                "Dalle et plancher": [
                    { item: "Dalle b√©ton arm√© (15cm)", unit: "m¬≤", qtyPerM2: 1, priceUnit: 350, labor: 120 },
                    { item: "Poutrelles et hourdis", unit: "m¬≤", qtyPerM2: 1, priceUnit: 280, labor: 90 },
                    { item: "Chape de compression", unit: "m¬≤", qtyPerM2: 1, priceUnit: 85, labor: 45 }
                ]
            },
            "SECOND ≈íUVRE": {
                "Ma√ßonnerie et cloisonnement": [
                    { item: "Cloisons int√©rieures (brique 7cm)", unit: "m¬≤", qtyPerM2: 1.2, priceUnit: 55, labor: 30 },
                    { item: "Enduit int√©rieur", unit: "m¬≤", qtyPerM2: 3, priceUnit: 25, labor: 20 },
                    { item: "Enduit ext√©rieur", unit: "m¬≤", qtyPerM2: 2.5, priceUnit: 30, labor: 25 }
                ],
                "√âlectricit√©": [
                    { item: "Installation √©lectrique compl√®te", unit: "m¬≤", qtyPerM2: 1, priceUnit: 120, labor: 80 },
                    { item: "Tableau √©lectrique", unit: "unit√©", qtyPerM2: 0.01, priceUnit: 2500, labor: 800 },
                    { item: "Appareillage (prises, interrupteurs)", unit: "m¬≤", qtyPerM2: 1, priceUnit: 45, labor: 15 }
                ],
                "Plomberie": [
                    { item: "R√©seau eau froide/chaude", unit: "m¬≤", qtyPerM2: 1, priceUnit: 85, labor: 65 },
                    { item: "√âvacuation eaux us√©es", unit: "m¬≤", qtyPerM2: 1, priceUnit: 70, labor: 50 },
                    { item: "Sanitaires (lavabo, WC, douche)", unit: "unit√©", qtyPerM2: 0.05, priceUnit: 1800, labor: 400 }
                ]
            },
            "FINITIONS": {
                "Rev√™tements sols": [
                    { item: "Carrelage sol (moyen standing)", unit: "m¬≤", qtyPerM2: 1, priceUnit: 120, labor: 45 },
                    { item: "Plinthes", unit: "ml", qtyPerM2: 0.4, priceUnit: 25, labor: 10 }
                ],
                "Peinture et d√©coration": [
                    { item: "Peinture int√©rieure", unit: "m¬≤", qtyPerM2: 3, priceUnit: 18, labor: 12 },
                    { item: "Peinture ext√©rieure", unit: "m¬≤", qtyPerM2: 2.5, priceUnit: 22, labor: 15 }
                ],
                "Menuiserie": [
                    { item: "Portes int√©rieures", unit: "unit√©", qtyPerM2: 0.08, priceUnit: 1200, labor: 200 },
                    { item: "Fen√™tres aluminium", unit: "m¬≤", qtyPerM2: 0.15, priceUnit: 650, labor: 150 },
                    { item: "Porte d'entr√©e blind√©e", unit: "unit√©", qtyPerM2: 0.01, priceUnit: 4500, labor: 500 }
                ]
            },
            "√âTANCH√âIT√â ET TOITURE": {
                "Toiture": [
                    { item: "√âtanch√©it√© terrasse", unit: "m¬≤", qtyPerM2: 1, priceUnit: 95, labor: 55 },
                    { item: "Forme de pente", unit: "m¬≤", qtyPerM2: 1, priceUnit: 45, labor: 30 },
                    { item: "Protection √©tanch√©it√©", unit: "m¬≤", qtyPerM2: 1, priceUnit: 35, labor: 20 }
                ]
            },
            "CL√îTURE": {
                "Cl√¥ture du terrain": [
                    { item: "Mur de cl√¥ture (parpaings + enduit)", unit: "ml", qtyPerClature: 1, priceUnit: 380, labor: 170 },
                    { item: "Portail m√©tallique", unit: "unit√©", qtyPerClature: 0.015, priceUnit: 8500, labor: 1500 }
                ]
            }
        };

        // Copie profonde pour les donn√©es de travail
        let costData = JSON.parse(JSON.stringify(defaultCostData));

        function calculateCosts() {
            const surfaceSS = parseFloat(document.getElementById('surfaceSousSol').value) || 0;
            const surfaceRDC = parseFloat(document.getElementById('surfaceRDC').value) || 0;
            const surface1er = parseFloat(document.getElementById('surface1erEtage').value) || 0;
            const perimetreClature = parseFloat(document.getElementById('perimetreClature').value) || 0;
            
            const totalSurface = surfaceSS + surfaceRDC + surface1er;
            
            const tbody = document.getElementById('costTableBody');
            tbody.innerHTML = '';
            
            let grandTotalMaterials = 0;
            let grandTotalLabor = 0;
            let grandTotal = 0;
            let itemIndex = 0;

            for (const [category, subcategories] of Object.entries(costData)) {
                const categoryRow = tbody.insertRow();
                categoryRow.className = 'category-row';
                categoryRow.innerHTML = `<td colspan="8">${category}</td>`;
                
                let categoryTotalMaterials = 0;
                let categoryTotalLabor = 0;

                for (const [subcat, items] of Object.entries(subcategories)) {
                    for (const item of items) {
                        const row = tbody.insertRow();
                        
                        let quantity;
                        if (category === "CL√îTURE") {
                            quantity = item.qtyPerClature * perimetreClature;
                        } else {
                            quantity = item.qtyPerM2 * totalSurface;
                        }
                        
                        const materialsCost = quantity * item.priceUnit;
                        const laborCost = quantity * item.labor;
                        const totalCost = materialsCost + laborCost;
                        
                        categoryTotalMaterials += materialsCost;
                        categoryTotalLabor += laborCost;
                        
                        row.innerHTML = `
                            <td>${item.item}</td>
                            <td>${item.unit}</td>
                            <td>${quantity.toFixed(2)}</td>
                            <td>
                                <input type="number" 
                                       class="editable-input material" 
                                       value="${item.priceUnit.toFixed(2)}" 
                                       data-index="${itemIndex}"
                                       data-type="material"
                                       step="0.01"
                                       min="0">
                            </td>
                            <td>
                                <input type="number" 
                                       class="editable-input labor" 
                                       value="${item.labor.toFixed(2)}" 
                                       data-index="${itemIndex}"
                                       data-type="labor"
                                       step="0.01"
                                       min="0">
                            </td>
                            <td>${materialsCost.toFixed(2)}</td>
                            <td>${laborCost.toFixed(2)}</td>
                            <td><strong>${totalCost.toFixed(2)}</strong></td>
                        `;
                        
                        itemIndex++;
                    }
                }
                
                const subtotalRow = tbody.insertRow();
                subtotalRow.className = 'subtotal-row';
                const categoryTotal = categoryTotalMaterials + categoryTotalLabor;
                subtotalRow.innerHTML = `
                    <td colspan="5"><strong>Sous-total ${category}</strong></td>
                    <td><strong>${categoryTotalMaterials.toFixed(2)}</strong></td>
                    <td><strong>${categoryTotalLabor.toFixed(2)}</strong></td>
                    <td><strong>${categoryTotal.toFixed(2)}</strong></td>
                `;
                
                grandTotalMaterials += categoryTotalMaterials;
                grandTotalLabor += categoryTotalLabor;
                grandTotal += categoryTotal;
            }
            
            const totalRow = tbody.insertRow();
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="5"><strong>TOTAL G√âN√âRAL</strong></td>
                <td><strong>${grandTotalMaterials.toFixed(2)}</strong></td>
                <td><strong>${grandTotalLabor.toFixed(2)}</strong></td>
                <td><strong>${grandTotal.toFixed(2)}</strong></td>
            `;
            
            updateSummaryCards(totalSurface, grandTotalMaterials, grandTotalLabor, grandTotal);
            attachPriceChangeListeners();
        }

        function attachPriceChangeListeners() {
            document.querySelectorAll('.editable-input').forEach(input => {
                input.addEventListener('input', function() {
                    const index = parseInt(this.dataset.index);
                    const type = this.dataset.type;
                    const newValue = parseFloat(this.value) || 0;
                    
                    let currentIndex = 0;
                    for (const category of Object.values(costData)) {
                        for (const items of Object.values(category)) {
                            for (const item of items) {
                                if (currentIndex === index) {
                                    if (type === 'material') {
                                        item.priceUnit = newValue;
                                    } else {
                                        item.labor = newValue;
                                    }
                                    calculateCosts();
                                    return;
                                }
                                currentIndex++;
                            }
                        }
                    }
                });
            });
        }

        function updateSummaryCards(surface, materials, labor, total) {
            const summaryCards = document.getElementById('summaryCards');
            const pricePerM2 = surface > 0 ? total / surface : 0;
            summaryCards.innerHTML = `
                <div class="summary-card">
                    <h3>Surface Totale</h3>
                    <div class="amount">${surface.toFixed(0)} m¬≤</div>
                </div>
                <div class="summary-card">
                    <h3>Co√ªt Mat√©riaux</h3>
                    <div class="amount">${materials.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " ")} DH</div>
                </div>
                <div class="summary-card">
                    <h3>Co√ªt Main d'≈íuvre</h3>
                    <div class="amount">${labor.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " ")} DH</div>
                </div>
                <div class="summary-card">
                    <h3>Co√ªt Total</h3>
                    <div class="amount">${total.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " ")} DH</div>
                </div>
                <div class="summary-card">
                    <h3>Prix au m¬≤</h3>
                    <div class="amount">${pricePerM2.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " ")} DH</div>
                </div>
            `;
        }

        function resetPrices() {
            if (confirm('Voulez-vous vraiment r√©initialiser tous les prix aux valeurs par d√©faut ?')) {
                costData = JSON.parse(JSON.stringify(defaultCostData));
                calculateCosts();
            }
        }

        function exportToCSV() {
            let csv = 'Poste,Unit√©,Quantit√©,Prix Mat. Unit. (MAD),Prix M.O. Unit. (MAD),Co√ªt Mat√©riaux (MAD),Co√ªt M.O. (MAD),Total (MAD)\n';
            
            const table = document.getElementById('costTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const cols = row.querySelectorAll('td');
                if (cols.length > 0) {
                    const rowData = [];
                    cols.forEach((col, idx) => {
                        if (idx === 3 || idx === 4) {
                            const input = col.querySelector('input');
                            if (input) {
                                rowData.push('"' + input.value + '"');
                            }
                        } else {
                            rowData.push('"' + col.textContent.trim() + '"');
                        }
                    });
                    csv += rowData.join(',') + '\n';
                }
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'devis_construction_villa_personnalise.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Event listeners
        document.getElementById('surfaceSousSol').addEventListener('input', calculateCosts);
        document.getElementById('surfaceRDC').addEventListener('input', calculateCosts);
        document.getElementById('surface1erEtage').addEventListener('input', calculateCosts);
        document.getElementById('perimetreClature').addEventListener('input', calculateCosts);

        // Calcul initial
        calculateCosts();
    </script>
</body>
</html>
